{% extends 'base.html' %}

{% block head %} 
  <title> Search Employees </title>
{% endblock %}

{% block content %}

  <div id='employee_search'>

    <h3>Employee Search</h3>

    <form id='search'>
      <!-- TODO: make disable select value to be possible to be selected for null -->
      <select name='company' id='company'>
        <option></option>
        {% for company in companies %}
          <option value='{{ company.company_name }}'>
            {{ company.company_name }}
          </option>
        {% endfor %}
      </select>

      <select name='department' id='department'>
        <option></option>
        {% for department in departments %}          
          <option value='{{ department.department_name }}'>
            {{ department.department_name }}
          </option>
        {% endfor %}
      </select>
      <input type='text' name='first-name' id='first-name' placeholder="First Name">
      <input type='text' name='last-name' id='last-name' placeholder="Last Name">
      <input type='submit'> 
    </form>
  </div>
  <div id="page-number"></div>

  <!-- no need to load entire thing. make a page break -->
  <div id="active_search_result">
    <ul id="emp_list">
      {% for employee in employees %}
          <li>
            <a href = '/employee/{{ employee.employee_id }}'>
              {{ employee.first_name }} {{ employee.last_name }} 
            </a>
          </li>
      {% endfor %}
    </ul>
  </div>
  <script type="text/javascript">
    
    var continueLoading = true
    var limit = 10
    var pageLimit = 10
    var pageOffset = 0

    if ({{employee_count}} % limit != Math.floor({{employee_count}} % limit)){
      var pageNumbers = {{employee_count}}/limit + 1
    }else{
      var pageNumbers = {{employee_count}}/limit
    }

/////////////////// Load first page with page numbers //////////////////////
    showPageNumbers(pageOffset, pageLimit);

    // show a list of page numbers to choose from
    function showPageNumbers(pageOffset, pageLimit){
      // empty the page nuber location
      $("#page-number").html('');      
      // buling the page numbers
      for (var j=pageOffset; j<= pageLimit+pageOffset; j++){
        $("#page-number").append(" <a class = 'myButton' id='page-"+j+"'>" + (j+1) + "</a>")
      }
      // next
      $("#page-number").append(" <a id='page-next'> Next </a>")
      nextPage();
      // previous
      if(pageOffset != 0){
        $("#page-number").prepend(" <a id='page-prev'> Prev </a>")
        previousPage();
      }
    }

    // activates next page numbers button
    function nextPage(){
      // bump up the offset by limit if the next is pressed
      $("#page-next").on('click', function(evt){
          pageOffset = pageOffset+pageLimit
          showPageNumbers(pageOffset, pageLimit)
        });
    }

    // activates previous page numbers button
    function previousPage(){
      $("#page-prev").on('click', function(evt){
          pageOffset = pageOffset-pageLimit
          showPageNumbers(pageOffset, pageLimit)
        });      
    }

    // load first page
    function showCurrentPage(limit){
      for (var offset = 10; offset < 30; offset= offset + limit) {
        $.get("/employee/data/"+offset+"/"+limit, function(data){
          for(var i = 0; i<limit; i++){
            if (continueLoading){
              var nameListItem = '<li class="dym">'+data.employees[i].first_name+" "+data.employees[i].last_name+ '</li>'
              var employee_id = data.employees[i].employee_id
              $('#emp_list').append('<a href="/employee/'+ employee_id+ '/">'+nameListItem+'</a>');
            }
            else{
              window.stop();
            }
          }
        })
      } 
    }

    // turns on the underline of the page
    $("#page-1").css(
      'text-decoration', 'underline'
    )

/////////////////// Load page with page number clicked //////////////////////

    // when clicked the page number
    $(".myButton").click(function(){
      var page = $(this).attr('id');
      var pageNumber = Number(page.replace("page-",""));
      alert(pageNumber);
      showClicked(pageNumber)
    });

    // load people on clicked page
    function showClicked(pageNumber){
      var offset2 = pageNumber*limit
      console.log(offset2, limit)
      $("#emp_list").html('');
      $.get("/employee/data/"+offset2+"/"+limit, function(data){
        // // need to get the employees with employee id, but right now arbitrary employees
        // for (var i = offset2; i < offset2 + limit; i++){
        //   if (data.employees[i].employee_id == i){
        //     console.log(data.employee[i]);
        //   }
        // }

        for(var i = 0; i<limit; i++){
          if (continueLoading){
            var nameListItem = '<li class="dym">'+data.employees[i].first_name+" "+data.employees[i].last_name+ '</li>'
            var employee_id = data.employees[i].employee_id
            $('#emp_list').append('<a href="/employee/'+ employee_id+ '/">'+nameListItem+'</a>');


          }
          else{
            window.stop();
          }
        }
      })
    }

  </script>
  <script src="/static/js/employee_list.js" type="text/javascript"></script>

{% endblock %}